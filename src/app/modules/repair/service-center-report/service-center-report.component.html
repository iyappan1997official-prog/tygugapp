<!---<div class="content-wrapper">

   <div class="card p-4 cardheight" [formGroup]="serviceCenterForm">

    
    <div fxLayout="row" fxLayoutAlign="start center">
      <h2 class="mb-0 main-color font-w-600 fs-24">
        <img class="cursor mb-1 doNotPrint"
             src="../../../../assets/logos/arrow-backP.svg"
             routerLink="/repair/repair-reports">
        &nbsp;Service Center Report
      </h2>
    </div>

    
    <div fxLayout="row"
         fxLayout.lt-md="column"
         fxLayoutAlign="space-between center"
         class="mt-3">

      <div fxLayout="row"
           fxLayoutGap="10px"
           fxLayout.lt-md="column"
           fxLayoutAlign="start center"
           class="w-100">

        <mat-form-field appearance="outline" class="input-pdt fs-16 searchBox">
          <mat-icon matPrefix class="sub-prefix">search</mat-icon>
          <mat-select placeholder="Quilt status"
                      class="w-100 form-control p-0"
                      style="border:none;"
                      formControlName="quiltStatusId">
            <mat-option value="0">All</mat-option>
            <ng-container *ngFor="let status of allQuiltStatus">
              <mat-option [value]="status.id">
                {{status.name}}
              </mat-option>
            </ng-container>
          </mat-select>
        </mat-form-field>

      </div>

      <div fxLayout="row"
           fxLayoutAlign="space-between center"
           fxLayoutGap="20px"
           class="border-left ps-3">

        <button class="btn btn-newPrimary btncolor p-12 mb-xl-0 mb-3"
                (click)="searchReport()">
          Search
        </button>

        <button class="btn btnborder p-12 mb-xl-0 mb-3"
                (click)="resetReport()">
          Reset
        </button>

        <button class="btn btn-newPrimary p-12 text-white btncolor">
          Print
        </button>

      </div>
    </div>

    
    <div fxLayout="row"
         fxLayoutGap="20px"
         fxLayoutAlign="center"
         class="my-3 align-items-center">

      <div class="card sub-card text-center p-3">
        <div class="mb-1 text-color">Total Quilts </div>
        <div class="font-w-600 text-color">{{usageData?.totalquilts || 0}}</div>
      </div>

      <div class="card sub-card text-center p-3">
        <div class="mb-1 text-color">Cleaned</div>
        <div class="font-w-600 text-color">{{usageData?.cleaning || 0}}</div>
      </div>

      <div class="card sub-card text-center p-3">
        <div class="mb-1 text-color">Repaired</div>
        <div class="font-w-600 text-color">{{usageData?.repairing || 0}}</div>
      </div>

      <div class="card sub-card text-center p-3">
        <div class="mb-1 text-color">Retired</div>
        <div class="font-w-600 text-color">{{usageData?.retired || 0}}</div>
      </div>

      <div class="date-export-row">

        <button class="btn btnborder p-12">
                (click)="exportReport()"
          Export
        </button>

      </div>

    </div>

   
    <div class="table-responsive">
      <table class="table">
        <thead>
          <tr class="tablelight text-center">
            <th>Location</th>
            <th>Total Returned</th>
            <th>Cleaned </th>
            <th>Repaired</th>
            <th>Retired</th>

          </tr>
        </thead>

        <tbody>
          <ng-container *ngIf="items$ | async as dataList">
            <ng-container *ngFor="let data of dataList; let i = index">

              <tr class="text-center">
                <td class="cursor" (click)="toggleRow(i)">
                  {{ data.location }}
                </td>
                <td>{{data.totalReturned }}</td>
                <td>{{ data.cleaningCount }}</td>
                <td>{{ data.repairingCount }}</td>
                <td>{{ data.retringCount }}</td>
              </tr>

              
              <tr *ngIf="expandedIndex === i">
                <td colspan="7">
                  <table class="table w-100">
                    <thead>
                      <tr class="text-center">
                        <th>PartNumber</th>
                        <th>Total Returned</th>
                        <th>Cleaned</th>
                        <th>Repaired</th>
                        <th>Retired</th>
                      </tr>
                    </thead>
                    <tbody>
                      <tr class="text-center"
                          *ngFor="let sub of data.quiltsUsageCustomer">
                        <td>{{ sub.partNumber }}</td>
                        <td>{{data.totalReturned }}</td>
                        <td>{{ sub.cleaningCount }}</td>
                        <td>{{ sub.repairingCount }}</td>
                        <td>{{ sub.retringCount }}</td>
                      </tr>
                    </tbody>
                  </table>
                </td>
              </tr>

            </ng-container>
          </ng-container>
        </tbody>
      </table>
    </div>

     
    <mat-paginator [length]="length"
                   [pageSize]="pageSize"
                   [pageSizeOptions]="pageSizeOptions"
                   (page)="paginator($event)"
                   showFirstLastButtons>
    </mat-paginator>

  </div>
</div> -->
<div class="content-wrapper">
  <div class="card p-4 cardheight" [formGroup]="serviceCenterForm">
    <div fxLayout="row" fxLayoutAlign="start center">
      <h2 class="mb-0 main-color font-w-600 fs-24">
        <img class="cursor mb-1 doNotPrint"
             src="../../../../assets/logos/arrow-backP.svg"
             routerLink="/repair/repair-reports">
        &nbsp;Service Center Report
      </h2>
    </div>


    <div fxLayout="row"
         fxLayout.lt-md="column"
         fxLayoutAlign="space-between center"
         class="mt-3">

      <div fxLayout="row"
           fxLayoutGap="10px"
           fxLayout.lt-md="column"
           fxLayoutAlign="start center"
           class="w-100">

        <mat-form-field appearance="outline" class="input-pdt fs-16 searchBox">
          <mat-icon matPrefix class="sub-prefix">search</mat-icon>
          <mat-select placeholder="Quilt status"
                      class="w-100 form-control p-0"
                      style="border:none;"
                      formControlName="quiltStatusId">
            <mat-option value="0">All</mat-option>
            <ng-container *ngFor="let status of allQuiltStatus">
              <mat-option [value]="status.id">
                {{status.name}}
              </mat-option>
            </ng-container>
          </mat-select>
        </mat-form-field>
        <div *ngIf="dateRangeDisplay" class="report-date-text">
          {{ dateRangeDisplay }}
        </div>

      </div>

      <div fxLayout="row"
           fxLayoutAlign="space-between center"
           fxLayoutGap="20px"
           class="border-left ps-3">

        <button class="btn btn-newPrimary btncolor p-12 mb-xl-0 mb-3"
                (click)="searchReport()">
          Search
        </button>

        <button class="btn btnborder p-12 mb-xl-0 mb-3"
                (click)="resetReport()">
          Reset
        </button>

        <button class="btn btn-newPrimary p-12 text-white btncolor">
          Print
        </button>

      </div>
    </div>


    <div fxLayout="row" fxLayoutAlign="start center" class="my-3 w-100">

      <!-- LEFT EMPTY FLEX (balances center) -->
      <div fxFlex></div>

      <!-- CENTER CARDS GROUP -->
      <div fxLayout="row"
           fxLayoutGap="16px"
           fxLayoutAlign="center center"
           class="cards-wrapper">

        <div class="card sub-card text-center p-3">
          <div class="mb-1 text-color">Total Quilts</div>
          <div class="font-w-600 text-color">{{usageData?.totalquilts || 0}}</div>
        </div>

        <div class="card sub-card text-center p-3">
          <div class="mb-1 text-color">Cleaned</div>
          <div class="font-w-600 text-color">{{usageData?.cleaning || 0}}</div>
        </div>

        <div class="card sub-card text-center p-3">
          <div class="mb-1 text-color">Repaired</div>
          <div class="font-w-600 text-color">{{usageData?.repairing || 0}}</div>
        </div>

        <div class="card sub-card text-center p-3">
          <div class="mb-1 text-color">Retired</div>
          <div class="font-w-600 text-color">{{usageData?.retired || 0}}</div>
        </div>

      </div>

      <!-- RIGHT SIDE EXPORT -->
      <div fxFlex fxLayoutAlign="end center">
        <button class="btn btnborder p-12">
          Export
        </button>
      </div>

    </div>
    <div class="table-responsive mt-3">
      <table class="table repair-summary-table">
        <colgroup>
          <col style="width: 18%">
          <col style="width: 18%">
          <col style="width: 18%">
          <col style="width: 18%">
          <col style="width: 18%">
        </colgroup>
        <thead>
          <tr class="tablelight text-center">
            <th class="hierarchy-header">
              <span class="header-spacer"></span>
              Location
            </th>
            <th>Total Returned</th>
            <th>Cleaned</th>
            <th>Repaired</th>
            <th>Retired</th>
          </tr>
        </thead>

        <tbody>
          <ng-container *ngIf="items$ | async as dataList">

            <ng-container *ngFor="let data of dataList; let i = index">

              <!-- ================= LOCATION ================= -->
              <tr class="text-center">
                <td class="hierarchy-cell">
                  <div class="arrow-box" (click)="toggleRow(i)">
                    <img class="arrow-icon"
                         [src]="expandedIndex === i
                       ? '../../../../assets/logos/downarrowS.svg'
                       : '../../../../assets/logos/rightarrowS.svg'">
                  </div>
                  <div class="row-label">{{ data.location }}</div>
                </td>

                <td>{{ data.totalReturned }}</td>
                <td>{{ data.cleaningCount }}</td>
                <td>{{ data.repairingCount }}</td>
                <td>{{ data.retringCount }}</td>
              </tr>

              <!-- ================= PART TABLE ================= -->
              <tr *ngIf="expandedIndex === i">
                <td colspan="5" class="border-0 p-0">

                  <div class="part-wrapper">
                    <table class="table part-number-table">
                      <colgroup>
                        <col style="width: 17%">
                        <col style="width: 18%">
                        <col style="width: 18%">
                        <col style="width: 18%">
                        <col style="width: 18%">
                      </colgroup>
                      <thead>
                        <tr class="text-center">
                          <th class="hierarchy-header">
                            <span class="header-spacer"></span>
                            Part Number
                          </th>
                          <th>Total Returned</th>
                          <th>Cleaned</th>
                          <th>Repaired</th>
                          <th>Retired</th>
                        </tr>
                      </thead>

                      <tbody>

                        <ng-container *ngFor="let sub of data.quiltsUsageCustomer; let j = index">

                          <!-- PART ROW -->
                          <tr class="text-center">
                            <td class="hierarchy-cell">
                              <div class="arrow-box" (click)="togglePartDetails(i,j)">
                                <img class="arrow-icon"
                                     [src]="isPartExpanded(i,j)
                                   ? '../../../../assets/logos/downarrowS.svg'
                                   : '../../../../assets/logos/rightarrowS.svg'">
                              </div>
                              <div class="row-label">{{ sub.partNumber }}</div>
                            </td>

                            <td>{{ sub.totalReturned }}</td>
                            <td>{{ sub.cleaningCount }}</td>
                            <td>{{ sub.repairingCount }}</td>
                            <td>{{ sub.retringCount }}</td>
                          </tr>

                          <!-- ================= QUILT TABLE ================= -->
                          <tr *ngIf="isPartExpanded(i,j)">
                            <td colspan="5" class="border-0 p-0">

                              <div class="quilt-wrapper">
                                <table class="table quilt-table">
                                  <colgroup>
                                    <col style="width: 15.5%">
                                    <col style="width: 18.5%">
                                    <col style="width: 18%">
                                    <col style="width: 18%">
                                    <col style="width: 18%">
                                  </colgroup>
                                  <thead>
                                    <tr class="text-center">
                                      <th class="hierarchy-header">
                                        <span class="header-spacer"></span>
                                        Serial Number
                                      </th>
                                      <th>Total Returned</th>
                                      <th>Cleaned</th>
                                      <th>Repaired</th>
                                      <th>Retired</th>
                                    </tr>
                                  </thead>

                                  <tbody>
                                    <ng-container *ngFor="let quilt of sub.quilts; let k = index">
                                      <tr class="text-center">
                                        <td class="hierarchy-cell">
                                          <!-- SHOW ARROW ONLY IF DETAILS EXIST -->
                                          <div class="arrow-box"
                                               *ngIf="hasDetails(quilt)"
                                               (click)="toggleQuiltDetails(i,j,k)">
                                            <img class="arrow-icon"
                                                 [src]="isQuiltExpanded(i,j,k)
             ? '../../../../assets/logos/downarrowS.svg'
             : '../../../../assets/logos/rightarrowS.svg'">
                                          </div>
                                          <!-- If no details, keep alignment -->
                                          <div class="arrow-box" *ngIf="!hasDetails(quilt)"></div>
                                          <div class="row-label">
                                            {{ quilt.serialNumber }}
                                          </div>
                                        </td>

                                        <td>{{ quilt.returned }}</td>
                                        <td>{{ quilt.cleaned }}</td>
                                        <td>{{ quilt.repaired }}</td>
                                        <td>{{ quilt.retired }}</td>
                                      </tr>
                                      <tr *ngIf="isQuiltExpanded(i,j,k) && hasDetails(quilt)">
                                        <td></td>
                                        <td></td>
                                        <td class="p-0 repair-details-cell">

                                          <!-- Repair Details -->
                                          <div class="repair-details-column"
                                               *ngIf="quilt.repairTypes?.trim() && quilt.repairTypes !== 'None'">

                                            <div class="repair-details-header">Repair Details</div>

                                            <ul class="repair-details-list">
                                              <li *ngFor="let r of quilt.repairTypes.split(',')">
                                                {{ r }}
                                              </li>
                                            </ul>
                                          </div>
                                        </td>

                                        <!-- Retired Details -->
                                        <td class="p-0 retired-details-cell">
                                          <div class="retired-details-column"
                                               *ngIf="quilt.retiredTypes?.trim() && quilt.retiredTypes !== 'None'">

                                            <div class="retired-details-header">Retired Details</div>

                                            <ul class="retired-details-list">
                                              <li *ngFor="let r of quilt.retiredTypes.split(',')">
                                                {{ r }}
                                              </li>
                                            </ul>
                                          </div>
                                        </td>
                                        <td></td>
                                      </tr>
                                    </ng-container>
                                  </tbody>

                                </table>
                              </div>

                            </td>
                          </tr>

                        </ng-container>

                      </tbody>

                    </table>
                  </div>

                </td>
              </tr>

            </ng-container>

          </ng-container>
        </tbody>

      </table>
    </div>

    <mat-paginator [length]="length"
                   [pageSize]="pageSize"
                   [pageSizeOptions]="pageSizeOptions"
                   (page)="paginator($event)"
                   showFirstLastButtons>
    </mat-paginator>
  </div>
</div>
